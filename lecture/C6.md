# 06.数据类型和运算

[06.1基础数据类型](#061-数据基础类型)

[06.2其他运算](#062-其他运算)

[06.3第六章习题](#063-第六章习题)

## 06.1 基础数据类型

在前面的学习中我们知道，C是有类型的语⾔。

C语⾔的变量，必须：在使⽤前定义，并且确定类型

C以后的语⾔向两个⽅向发展：

1. C++/Java更强调类型，对类型的检查更严格
2. JavaScript、Python、PHP不看重类型，甚⾄不需要事先定义

像C语言等强调类型的语言遵循类型安全的理论。支持者认为明确的类型有助于尽早发现程序中的简单错误，反对强类型的观点认为过于强调类型迫使程序员⾯对底层、实现⽽⾮事务逻辑。

总的来说，早期语⾔强调类型，⾯向底层的语⾔强调类型。C语⾔需要类型，但是对类型的安全检查并不⾜够。

### C语言的类型

1. 整数

2. - char、short、int、long、long long

3. 浮点数

4. - float、double、long double

5. 逻辑

6. - bool

7. 指针

8. 自定义

其中bool是C99才有的类型

#### 类型有何不同

1. 类型名称：int、long、double
2. 输⼊输出时的格式化：%d、%ld、%lf
3. 所表达的数的范围：char < short < int < float < double
4. 内存中所占据的⼤⼩：1个字节到16个字节
5. 内存中的表达形式：⼆进制数（补码）可以直接作运算、编码不能直接作运算

#### sizeof

C语言中，sizeof是⼀个运算符（如果感到疑惑可以参考[CSDN](https://blog.csdn.net/kangjianwei101/article/details/50363713)或者[stackoverflow](https://stackoverflow.com/questions/1393582/why-is-sizeof-considered-an-operator)），给出某个类型或变量在内存中所占据的字节数，例如

sizeof(int) ，算的是整数类型在内存中所占据的字节数

sizeof(i)，算的是i这个变量在内存中所占据的字节数

<u>***演示***</u>代码如下

```c
#include <stdio.h>

int main(void) {
    int a = 6;
    printf("sizeof(long double)=%ld\n", sizeof(long double));
    printf("sizeof(double)=%ld\n", sizeof(double));
    printf("sizeof(long long)=%ld\n", sizeof(long long));
    printf("sizeof(long)=%ld\n", sizeof(long));
    printf("sizeof(int)=%ld\n", sizeof(int));
    printf("sizeof(a)=%ld\n", sizeof(a));
    return 0;
}
```

如果大家在自己的电脑上尝试，有的同学会发现long double的字节数和我不一样，这是正常的。因为C标准只要求long double比double精度高，具体字节数并没有规定。

sizeof是静态运算符，它的结果在编译时刻就决定了，因此***不要在sizeof的括号⾥做运算，这些运算不会做的。***

### 整数类型

由于C诞生时间较早，所以为了兼容许多老旧设备，很多C语言内的很多内容都可以看出兼容性。

1. char：1字节（8⽐特，即8个二进制的位）
2. short：2字节
3. int：取决于编译器（CPU），通常的意义是“1个字”
4. long：取决于编译器（CPU），通常的意义是“1个字”
5. long long：8字节

大家注意到int和long并没有标准定义内存字节数，所以同学们在自己的电脑上运行可能结果不一样。

为什么int和long的内存大小不确定呢？因为int在C语言中代表了一个字长，对这部分底层感兴趣的同学可以参考下图

<img src="./C6/flowchart1.png" alt="flowchart1" style="zoom:38%;" />

int就是代表寄存器字长的，而long则规定至少4字节以及不小于int，但是没有规定其上限。那我们接下来就来研究一下数的范围。

#### 数的范围

对于⼀个字节（8位）即char，可以表达的是：00000000 - 11111111 

其中：00000000 -> 0，11111111 ~ 10000000 -> -1 ~ -128，00000001 ~ 01111111 -> 1 ~ 127

下面的代码就使得char溢出了

```c
#include <stdio.h>

int main(void) {
    char c = 255;
    int a = 255;
    printf("c=%d, a=%d\n", c, a);
    return 0;
}
```

##### 整数的范围

char：1字节：-128 ~ 127

short：2字节：-32768 ~ 32767

int：取决于编译器（CPU），通常的意义是“1个字” -2^31 ~ 2^31-1

long：起码4字节

long long：8字节

##### 整数越界

整数是以纯⼆进制⽅式进⾏计算的，例如：

- 11111111 + 1 -> 100000000 -> 0 
- 01111111 + 1 -> 10000000 -> -128 
- 10000000 - 1 -> 01111111 -> 127

如果操作使得数据超过了他们的范围，那么就会溢出出错，如下面的代码

```c
#include <stdio.h>

int main(void) {
    char c = 127;
    c++;
    printf("c=%d\n", c);
    c = -128;
    c--;
    printf("c=%d\n", c);
    return 0;
}
```

大家如果要方便理解可以参考下面的图，把char的范围想象成一个圆环：

<img src="./C6/overflow.png" alt="overflow" style="zoom:38%;" />

#### unsigned

在整形类型前加上unsigned使得它们成为⽆符号的整数，注意unsigned并没有改变数据内部的⼆进制表达没变，变的是如何看待它们。

```c
#include <stdio.h>

int main(void) {
    unsigned char c = 255;
    int a = 255;
    printf("c=%d, a=%d\n", c, a);
    return 0;
}
```

我可以看到，11111111，对于char，是-1；对于unsigned char，是255。

如果⼀个字⾯量常数想要表达⾃⼰是unsigned，可以在后⾯加u或U，例如255U。

相似的，我们也可以⽤l或L表⽰long(long)。

***不要滥用unsigned，它的初衷并⾮扩展数能表达的范围，⽽是为了做纯⼆进制运算，主要是为了移位以及表达非负数。***

#### 整数的输入输出

我们暂时只需要掌握两种形式：int或long long，%d：int，%u：unsigned，%ld：long long，%lu：unsigned long long。

注意，比int还要小的整数类型都可以使用%d，long则和long long相同。

如果不遵守格式会如何？参考下图

```c
#include <stdio.h>

int main(void) {
    char c = -1;
    int i = -1;
    printf("c=%u,i=%u\n", c, i);
    return 0;
}
```

这个例子我们可以看到，数据除了和它本身的内容有关以外，和程序的看待方式也有密不可分的关系。

#### 8进制和16进制

⼀个以0开始的数字字⾯量是8进制

⼀个以0x开始的数字字⾯量是16进制

%o⽤于8进制，%x⽤于16进制

8进制和16进制只是如何把数字表达为字符串，与内部如何表达数字⽆关

#### 选择整数类型

学习了那么多整数类型，大家可能已经有点晕了。那么为什么整数要有那么多种？为了准确表达内存，做底层程序的需要。

***在我们大部分的实际应用中，如果没有特殊需要（比如做底层），就选择int。***

- 现代的CPU的字⻓普遍是32位或64位，⼀次内存读写就是⼀个int，⼀次计算也是⼀个int，选择更短的类型（比如short或者char）不会更快，甚⾄可能更慢。具体参考字长那里的图。
- 现代的编译器⼀般会设计内存对⻬，所以更短的类型实际在内存中有可能也占据⼀个int的⼤⼩（虽然sizeof告诉你更⼩）。这一点我们后来会继续深入。

***unsigned与否只是输出的不同，内部计算是⼀样的。***

本章忽略了很多计算机和数学相关的原理，有兴趣的同学可以参考[C6补充资料](./C6/supplement.md)

### 浮点类型

### 字符类型

### *逻辑类型（仅C99标准）

#### bool

\#include <stdbool.h>

之后就可以使⽤bool和true、false

##### bool的运算

bool实际上还是以int的⼿段实现的，所以可以当作int来计算，也只能当作int来输⼊输出

### 类型转换

#### 自动类型转换

当运算符的两边出现不⼀致的类型时，会⾃动转换成较⼤的类型

- ⼤的意思是能表达的数的范围更⼤
- char -> short -> int -> long -> long long 
-  int -> float -> double
- 对于printf，任何⼩于int的类型会被转换成int；float会被转换成double
- 但是scanf不会，要输⼊short，需要%hd

#### 强制类型转换

要把⼀个量强制转换成另⼀个类型（通常是较⼩的类型），语法是

(*类型*)*值*

例如

```c
(int)10.2;
(short)32;
```

注意这时候的安全性，⼩的变量不总能表达⼤的量，例如

```c
(short)32768
```

##### 优先级

强制类型转换的优先级⾼于四则运算

## 06.2 其他运算

### 逻辑运算

逻辑运算是对逻辑量进⾏的运算，结果只有0（false）或1（true）

逻辑量是关系运算或逻辑运算的结果

| 运算符 | 描述   | 示例   | 结果                                               |
| ------ | ------ | ------ | -------------------------------------------------- |
| !      | 逻辑非 | !a     | 如果a是true结果就是false，如果a是false结果就是true |
| &&     | 逻辑与 | a&&b   | 如果a和b都是true，结果就是true；否则就是false      |
| \|\|   | 逻辑或 | a\|\|b | 如果a和b有一个是true，结果为true；否则是false      |

如果要表达数学中的区间，如：x∈(4,6)或x∈[4,6]，应该如何写C的表达式？

4<x<6不是C能正确计算的式子，因为4<x的结果是一个逻辑值（0或1）

如何判断一个字符c是否是大写字母？

```c
c >= 'A' && c <= 'Z'
```

再理解下面几个式子

```c
age > 20 && age < 30

index < 0 || index > 99

!age < 20
```

#### 优先级

! > && > ||

补充逻辑运算符后的运算符优先级表如下

| 优先级 | 运算符           | 综合性                 |
| ------ | ---------------- | ---------------------- |
| 1      | ()               | 从左到右               |
| 2      | ! + - ++ --      | 从右到左（单目的+和-） |
| 3      | */%              | 从左到右               |
| 4      | +-               | 从左到右               |
| 5      | < <= > >=        | 从左到右               |
| 6      | == !=            | 从左到右               |
| 7      | &&               | 从左到右               |
| 8      | \|\|             | 从左到右               |
| 9      | = += -= *= /= %= | 从右到左               |

#### 短路

逻辑运算是⾃左向右进⾏的，如果左边的结果已经能够决定结果了，就不会做右边的计算

- a==6 && b==1不会判断b == 1如果a == 6不成立
- a==6 || b+=1不会执行b += 1如果a == 6成立

对于&&，如果左边是false就不做右边了；对于||，如果左边是true就不做右边了。

***因此，不要把赋值，包括复合赋值组合进表达式***

### 条件运算符

看一个例子，count = (count > 20) ? count -10 : count+10;

=右边分别表示条件、条件满⾜时的值和条件不满⾜时的值，等价于

```c
if (count > 20) {
    count = count - 10;
} else {
    count = count + 10;
}
```

#### 优先级

条件运算符的优先级⾼于赋值运算符，但是低于其他运算符

大家可以尝试以下例子：

```c
m < n ? x : a + 5

a++ >= 1 && b-- > 2 ? a : b

x = 3 * a > 5 ? 5 : 20
```

#### 嵌套条件表达式

条件运算符是自右向左结合的

***避免使用嵌套条件表达式***

### 逗号运算符

逗号⽤来连接两个表达式，并以其右边的表达式的值作为它的结果。逗号的优先级是所有的运算符中最低的，所以它两边的表达式会先计算；逗号的组合关系是⾃左向右，所以左边的表达式会先计算，⽽右边的表达式的值就留下来作为逗号运算的结果。

主要在for中使⽤，例子如下

for ( i=0, j=10; i<j; i++, j- - ) ……

***除此之外，也请尽量避免使用逗号运算符***

## 06.3 第六章习题

1. 找出所有整数类型（包括unsigned）在你的编译器下的最大值和最小值以及最多数位是多少。